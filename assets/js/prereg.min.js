(function(){
const f=document.getElementById("preRegForm");
if(!f)return;
const e=document.getElementById("errorMessage"),
s=document.getElementById("success"),
re=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,
rp=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\[\]{};':"\\|,.<>\/?]).{6,21}$/;

f.addEventListener("submit",async function(t){
  t.preventDefault();
  e.classList.remove("show");
  const n=(f.nickname&&f.nickname.value||"").trim(),
  a=(f.email&&f.email.value||"").trim(),
  i=(f.password&&f.password.value||"").trim();
  if(!n||!a||!i){e.textContent="Please fill in all fields.";e.classList.add("show");return}
  if(!re.test(a)){e.textContent="Enter a valid e-mail.";e.classList.add("show");return}
  if(!rp.test(i)){e.textContent="Password must be 6-21 chars, include letters, numbers & special symbol.";e.classList.add("show");return}
  try{
    const r=await fetch(f.action,{method:f.method||"POST",body:new FormData(f),headers:{"Accept":"application/json"}});
    if(r.ok){f.style.display="none";if(s)s.style.display="flex";f.reset();setTimeout(()=>window.location.href="index.html",1200);return}
    let d=null;try{d=await r.json()}catch(e){}
    e.textContent=(d&&(d.error||d.message))?(d.error||d.message):"Something went wrong. Try again.";e.classList.add("show")
  }catch(o){e.textContent="Network error. Try again.";e.classList.add("show")}
})
})();