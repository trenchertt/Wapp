document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("preRegForm"),t=document.getElementById("errorMessage"),n=document.getElementById("success"),r=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,a=/^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*()_+\[\]{};':"\\|,.<>\/?]).{6,21}$/;function i(e){t.textContent=e,t.className="error-message show error",e=document.querySelectorAll("input"),e.forEach(e=>{e.classList.add("shake"),setTimeout(()=>e.classList.remove("shake"),400)})}e.addEventListener("submit",async t=>{t.preventDefault();const l=e.nickname.value.trim(),s=e.email.value.trim(),c=e.password.value;if(!l||!s||!c)return i("Please fill in all fields."),!1;if(!r.test(s))return i("Enter a valid e-mail."),!1;if(!a.test(c))return i("Password must be 6-21 chars, include letters, numbers & special symbol."),!1;try{const t=await fetch(e.action,{method:e.method,body:new FormData(e),headers:{"Accept":"application/json"}});t.ok?(e.style.display="none",n.style.display="flex",e.reset(),setTimeout(()=>{n.classList.add("fade-out"),setTimeout(()=>window.location.href="index.html",900)},3e3)):i("Something went wrong. Try again.")}catch(o){i("Network error. Try again.")}})});